__author__ = 'hao'
# -*- coding: utf-8 -*-
"""
Spyder Editor
"""
import mechanize
import cookielib
import urllib
import socket

# get app info htmls from Baidu

def get_html(docid):
    global timeout_occurred
    values = {'docid': docid}
    data = urllib.urlencode(values)
    geturl = base_url + '?' + data
    while timeout_occurred:
        try:
            # Open the page
            br.open(geturl, timeout=1.5)
            html = br.response().read()
            timeout_occurred = False
        except socket.timeout:
                timeout_occurred = True
        except mechanize.URLError as exc:#mechanize.URLError as exc:
            if isinstance(exc.reason, socket.timeout):
                timeout_occurred = True
        # retry
        #br.open(geturl, timeout=5)
    timeout_occurred = True

    file = open('/media/hao/Hitachi/BaiduApks/goodhtml/map/' + str(docid) + '.html', 'w')
    file.write(html)
    file.close()
    print geturl

# applist = [
#     7828321, 7825455, 7825456, 6401243, 7836009, 7798727, 7824339, 7762025, 7836217, 7830028, 7813414, 7832833, 7758939,
#     7830726, 7587105, 7806646, 4916035, 7835739, 7830136, 5982725, 7827991, 7779760, 7690704, 7264653, 7832435, 5963771,
#     7552912, 7779145, 7834981, 5092726, 5798086, 7659586, 7451785, 7829774, 5939395, 5867766, 7048087, 3511862, 7039221,
#     7264626, 5959509, 2399861, 7823462, 7708125, 7815708, 7832776, 7572860, 7825895, 7813825, 7747620, 5854551, 7829933,
#     7776330, 4926771, 7801829, 7199863, 7040549, 7823371, 7659861, 7762188, 7371702, 7827272, 3793665847, 7803930,
#     7789796, 4184161, 7826681, 7102828, 7770216, 7812954, 7820128, 7825174, 7821310, 7828865, 7516867, 7491415, 7816267,
#     7749383, 7720625, 4291719, 7339679, 5200207, 7340959, 7823403, 114595, 6395521, 7552746, 1930681844, 7073141, 2359751,
#     7719125, 5087468, 7494883, 7501129, 7829463, 5145287, 7828216, 1429872, 6201644, 2650920, 6590474, 7744994, 7535333,
#     7369643, 4081037, 2003741232, 6479929, 5064944, 5969199, 1081804, 7726044, 7503493, 7820382, 7819383, 579181, 7812039,
#     7275408, 5419111, 3782272, 7823579, 6441189, 5866157, 884211, 6440912, 7824678, 7706954, 6064877, 5882725, 6947720,
#     5452284, 6926677, 4349364, 7179619, 7797268, 7708416, 7296107, 7819943, 1357168, 5044329, 7816756, 7743907, 6854874,
#     6476097, 6012782, 6609740, 6795728, 2135805, 7455102, 7823168, 2076813, 6368177, 1148233, 6031089, 7810269, 7751205,
#     2841075, 7055816, 3625268, 6178601, 3282539, 7686665, 5997884, 1795583, 3163334, 5811095, 3911019, 5307038, 5998254,
#     2019723, 5857726, 5063271, 7483476, 5389847, 4167816, 7827396, 6170203, 5870258, 2148439626, 5839106, 6021842,
#     1849210, 7602532, 169985, 6214867, 3103678, 1338476, 5895906, 5157608, 6476739, 4785970, 5858902, 7074368, 6813925,
#     3185681528, 2441068, 7479329, 7823312, 7798528, 4831039, 7473250, 3204082, 2077883, 7141491, 5869783, 1724787,
#     6412322, 2211978, 3574899, 4340905, 5835899, 4777618, 5622850, 2639870, 3685464, 7532047, 6177945, 688171, 6513793,
#     7792716, 7818286, 6182408, 3502678, 7235548, 4466871, 3508959, 6796867, 4736364, 7728593, 2174759, 6180145, 6487589,
#     7813815, 5219384, 2274225759, 5999376, 530342, 5593875, 7546379, 1170046, 4778760, 1336465, 7812430, 6079355, 6019230,
#     4829759, 5204513, 5223903, 5892252, 6689758, 6944692, 7009296, 7289204, 2514738, 7067214, 5724281, 7441065, 6608975,
#     5863662, 7557775, 1698823, 5999011, 1882159, 1876432, 6170910, 5600051, 6397636, 2537998, 7814440, 2174675, 1057384,
#     7431818, 3230907, 6953118, 6016283, 6992081, 3007646, 2538828, 5923114, 7800834, 2477171, 2179720, 2159238, 1833569,
#     1183887, 7609712, 6371515, 6437086, 6006065, 2161317, 7808495, 1513850, 1062749, 5635900, 7437305, 7821775, 6798755,
#     5712529, 7815200, 7832863, 6135501, 7768421, 5116722, 6973246, 417223, 6851930, 2914834, 7304506, 7832491, 891639161,
#     7800135, 5114713, 7668409, 7661510, 7796485, 6810888, 7833489]

#applist = [7812130, 7789796, 7832803, 6481633, 7830636, 7784475, 7820802, 7824478, 7625687, 7817023, 7828134, 5001086, 7836520, 7831450, 7829477, 7832996, 7165227, 5660812, 7455195, 7256792, 7525591, 7827437, 7304672, 7835400, 7827758, 7258042, 7806231, 2373055, 7823246, 4979133, 7131905, 7827768, 7830665, 7806774, 6371607, 3571674, 7824932, 7557646, 1699137, 6951274, 7638407, 7825473, 5003047, 3139065, 7515333, 7819623, 7376306, 7827450, 2168618, 7823303, 5886716, 5885524, 7479052, 3211893, 5235947, 5562460, 7486494, 5890905, 3986116, 7820113, 7479867, 7746563, 7267874, 5981063, 7781274, 7835640, 5985562, 7819625, 6792556, 5906413, 7813538, 7344409, 1151891, 7343442, 7831016, 5878878, 7682959, 7526783, 5891203, 6984045, 4010975, 7580144, 7780888, 7599030, 6290566, 7829187, 6931702, 7324493, 7451435, 7707988, 7645116, 7774935, 6028965, 6819106, 5820941, 7479883, 7464993, 7585702, 7820462, 7807084, 7750077, 7704444, 6176421, 7400724, 3084420, 6138193, 7253008, 1749159, 4180446, 6167221, 3127503, 499012, 5254138, 5869357, 501180, 5468590, 5856941, 7828264, 4951715, 7788281, 2491498, 6860398, 7727954, 7826512, 5582640, 7695150, 2370742, 356188, 2084168, 7175285, 5863283, 7635438, 6565548, 4485714, 4889053, 46705790, 1486941, 2159147, 6212980, 2646074, 2383767, 6581114, 5032923, 7819290, 6649257, 6460935, 5945228, 6094524, 2083696, 7793582, 7711970, 3272941, 7811810, 102760, 6731228, 3288397, 6064484, 6103188, 7646295, 1896317, 4061235, 6847005, 6967998, 7432580, 7730934, 7764374, 7731701, 6060356, 7693495, 4854834, 5493437, 2710515, 7686464, 6364470, 7459781, 7732466, 2455414694, 5882655, 7253713, 7469534, 4914833, 5469430, 379578, 161989, 7822231, 5340826, 6980211, 4566666, 6044641, 6277683, 7813415, 3623065, 6401084, 3093120, 5864632, 3118143, 5886362, 6341637, 5883312, 7754472, 1840476, 2510936, 7531037, 5700311, 5314079, 7398963, 5573680, 1882220, 4967648, 5496096, 951254853, 1082612, 4719958, 6238464, 4612232, 5436010, 5576365, 5406726, 5850545, 5892220, 7784449, 6756057, 2719389, 7820804, 595845, 610054, 4813159, 2345492, 2623977, 5912256, 5651357, 5531818, 5469012, 6166575, 6408278, 7775037, 7828040, 7448461, 7441746, 7632290, 7740186, 7781705, 5955856, 7205133, 5553631, 128129, 5551580, 1044892, 7730736, 6002395, 7835286, 6076010, 5449348, 7017243, 551300, 7796838, 6048883, 7761101, 5567970, 583995, 5370675, 5922756, 5355861, 5834973, 6348864, 1704584, 7471362, 5992505, 7724975, 6043010, 5951394, 2014221144, 5672778, 5535813, 5990762, 2868320, 5724462, 5754173, 4165814, 5534183, 6029934, 5087553, 2532488, 7629166, 5174126, 6656513, 1154377, 7295754, 5986862, 1423302, 5537744, 2307457, 5584724, 5047270, 5916378, 6019870, 5590989, 5806098, 7836848, 7836549, 7836623, 7836904, 4993673, 7786944, 7832985, 7100378, 5265407, 7654771, 7476228, 7818296, 7102299, 7837111, 7754956, 7439924, 7739312, 7837022, 7815805, 7581316, 7770832, 7582023, 7714661, 7830030, 7731029, 7836786, 7836874, 7727992, 7837153, 7837121, 7810391, 7836964, 7836987, 7833489, 7836640, 7836676, 7836906, 7836961, 7837021, 7837103]
applist = [7821148, 7833337, 7828388, 7829786, 7811723, 7799945, 7835314, 7821485, 3468721, 5835665, 806532, 7807978, 7816609, 7832575, 7380681, 7775528, 4914503, 7282862, 7795861, 7757670, 7628383, 7813025, 7240348, 7826639, 7806774, 7827058, 7784724, 7289332, 7812202, 7778192, 7833848, 7794790, 2650611, 7825002, 7512619, 7742398, 6379759, 7074423, 2612208, 7827396, 2844340, 7749017, 4652352, 7469985, 2513499, 5830272, 7820128, 7342401, 5158988, 6126684, 7693055, 4905686, 7834121, 4926771, 5890291, 2538848, 6853933, 7470055, 5082683, 7802598, 3243016, 7781725, 7805122, 4722450, 6398214, 4782754, 696628, 3119327, 1410863, 6427512, 5568047, 6489660, 4048268, 3986589044, 5519037, 1121027, 7337703, 7831753, 5532815, 5782036, 5035401, 6501904, 4617555, 7737194, 5413664, 6818466, 1610462320, 5302928, 6173892, 1782343, 6183677, 5895864, 4990077, 5946819, 5802087, 5887148, 7680351, 7425461, 549765954, 2623029, 170867, 6469478, 7449144, 7695144, 5871278, 5583376, 5532644, 931977, 4934311, 2537957, 4952700, 7263961, 1318155, 3121113, 7724205, 5880031, 5568656, 5584975, 7572661, 7801351, 4442928, 1683332014, 5851356, 6284768, 5883981, 6965333, 1118630, 7693115, 1094090496, 2295702, 7790265, 7782163, 2808094, 5565006, 3256534, 4074658, 5529795, 5884890, 2679354139, 7727954, 6455775, 7760958, 5597344, 3490861, 2339914, 5886715, 6981290, 1841969, 6440791, 6867593, 7267869, 5953818, 7455225, 5744513, 4707072, 4929900, 7704548, 5742225, 4748805, 3253817, 6522174, 1840048, 5068624, 4817596, 5956210, 7514529, 7220972, 6274354, 1355899, 7481742, 7730808, 5619221, 5770657, 7449855, 6323714, 7811930, 5847399, 7592764, 5931647, 2106682, 5212945, 5413213, 5574442, 7828888, 5101803, 5635138, 5615851, 4034700, 5965361, 7823803, 3095330, 4612153, 5769977, 870691639, 5845830, 1140670, 6258377, 5821381, 6601807, 5860757, 6486604, 4795440, 6112657, 3177279, 5487031, 2190957, 7595840, 3258030, 5717887, 5871347, 6344642, 5354804, 6408736, 6434911, 5887076, 6450069, 7011435, 4190343, 7820321, 1970482, 592638, 5871243, 2247986, 5846638, 1593234, 3008711, 5610808, 5908588, 5915272, 5197035, 6557331, 6404453, 330146, 7721566, 1106957, 1168376, 5352705, 5844208, 7204370, 7679516, 5959508, 6501858, 6258609, 5759548, 5936907, 6417772, 4100749, 5956081, 2599042, 4713273, 6212797, 1869647, 5945125, 6140126, 5946336, 3089204, 1840065, 3397161, 4932038, 977823, 5020349, 5717247, 6792749, 3210006, 5870948, 2920955, 5904951, 4669295, 7070863, 4785431, 5512917, 5605244, 5818020, 5286845, 6966816, 1862028, 1106987, 6710283, 1146658, 6264188, 5884371, 5820899, 7092887, 2920937, 6015078, 5565633, 3646080, 2702908, 5278574, 4934496, 2791058, 6257831, 5714462, 6747751, 5810588, 7040121, 7815810, 7825304, 7837691, 7837805, 7824213, 7837783, 7837482, 5028096, 6261256, 6640177, 7523833, 7701257, 7836620, 7836545, 7681336, 7827013, 7545668, 5475575, 7509637, 7502263, 7628779, 6624962, 7565324, 7511772, 7689141, 6098978, 2476297, 7040108, 7833602, 7287033, 7836558, 7836853, 7734450, 4916035, 7837251, 7732692, 7832331, 7799261, 7198966, 7524879, 7720412, 7816594, 7255131, 7836544, 6432052, 7786798, 7661531, 7796577, 7836756, 7833318, 7838192, 7837738, 6686387, 7315531, 7838066, 7071975, 7363991, 6981185, 7716963, 7657693, 7835400, 7819896, 7836854, 5523730, 7818431, 7836648, 7280862, 7785250, 7836606, 7788053, 7837782, 7750267, 7819374, 6607822, 7774484, 3004662, 7826410, 7837883, 7836975, 7731412, 7640851, 7837873, 7838016, 7837115, 7837993, 7837461, 7725610, 7838261, 7835570, 7836277, 7837298, 7836807, 7836987, 7838007, 7827337, 7837127, 7836092, 7837003, 7837059, 7837210, 7837344, 7837507, 7837549, 7838033, 7838167, 7838204]
br = mechanize.Browser()
cj = cookielib.LWPCookieJar()
br.set_cookiejar(cj)
# setting
br.set_handle_equiv(True)
br.set_handle_redirect(True)
br.set_handle_referer(True)
br.set_handle_robots(False)
base_url = 'http://shouji.baidu.com/soft/item'
# User-Agent (this is cheating, ok?)
user_agent = 'Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:38.0) Gecko/20100101 Firefox/38.0'
br.addheaders = [('User-agent',
                  'Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.0.1) Gecko/2008071615 Chrome/17.0.963.56 Fedora/3.0.1-1.fc9 Firefox/3.0.1')]
# Follows refresh 0 but not hangs on refresh > 0
br.set_handle_refresh(mechanize._http.HTTPRefreshProcessor(), max_time=1)
# br.set_debug_http(True)

timeout_occurred = True
for i in applist:
    get_html(i)
